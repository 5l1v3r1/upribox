---
- name: set hostname
  hostname: name="{{ hostname }}"
  
- name: configure hosts
  copy: src=hosts dest=/etc/hosts owner=root group=root mode=644
  
- name: install sudo
  apt: name={{ item }} state=present force=yes update_cache=yes cache_valid_time="{{ apt_cache_time }}"
  with_items:
    - sudo
  
- name: create sudo group
  group: name="{{ sudo_group }}" state=present
  
- name: create remote user
  user: name="{{ remote_user }}" shell="{{ remote_user_login_shell }}" groups="{{sudo_group}}" append=yes
  
- name: configure sudoers
  template: src=sudoers.j2 dest=/etc/sudoers validate='visudo -cf %s'
  
- name: add authorized key
  authorized_key: user="{{ remote_user }}" key="{{ lookup('file', '~/.ssh/id_rsa.pub') }}"
  when: pull_deployment is not defined

- name: disable root account
  shell: passwd -dl root
